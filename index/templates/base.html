<!DOCTYPE html>
{% load base_tags %}
{% load static %}
{% load i18n %}

{% load sass_tags %}

<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>
    <!--    JQUERY-->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

    <!--    POPPER-->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <!--    FONT AWESOME-->
    <link href="{% static 'fontawesome-5.13.0/css/all.css' %}" rel='stylesheet'/>
    <!--    BASE STYLE-->
    <link rel="stylesheet" href="{% static 'css/base.css' %}"/>
    <!--    BOOTSTRAP-->
    <link href="{% sass_src 'scss/base.scss' %}" rel="stylesheet" type="text/css" />
    <!--    BOOTSTRAP JS (LOAD AT END IMPORTANT)-->
    <script src="{% static 'bootstrap-4.4.1/js/bootstrap.min.js' %}"></script>
    <!--    SWEET ALERT 2-->
    <script src="{% static 'sweetalert2-9.10.12/sweetalert2.all.min.js' %}"></script>
    <!--    GOOGLE FONTS LOBSTER-->
    <link href="//fonts.googleapis.com/css?family=Montserrat&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    {% block styles %}
    {% endblock %}
    <style>
        .digi {
            font-family: 'Montserrat';
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-sm navbar-light bg-light digi">
        <a class="navbar-brand py-0" href="#">
            <img src="{% static 'images/test/logo2.png'%}" width="200" height="50" alt="">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse flex-grow-1 text-right" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto flex-nowrap">
<!--                <li class="nav-item {% if page == 'home' %} active {% endif %}">-->
<!--                    <a class="nav-link" href="#">{% trans 'Home' %}</a>-->
<!--                </li>-->
<!--                <li class="nav-item {% if page == 'login' %} active {% endif %}">-->
<!--                    {% if user.is_authenticated %}-->
<!--                        <a class="nav-link" href="#">{% trans 'Logout' %}</a>-->
<!--                    {% else %}-->
<!--                        <a class="nav-link" href="#">{% trans 'Login' %}</a>-->
<!--                    {% endif %}-->
<!--                </li>-->
                <li class="nav-item mx-1">
                    <a href="https://api.whatsapp.com/send?phone=1334534&text=Hola!%20Quisiera%20saber%20mas%20sobre%20Digimenu!%20Como%20podria%20tener%20mi%20menu%20digital?%20" type="button" class="btn btn-secondary">
                        {% trans 'Publish a menu' %}
                    </a>
                </li>
            </ul>
            <div class="btn-group btn-group-sm mx-1" role="group" aria-label="Basic example">
                {% get_current_language as LANGUAGE_CODE %}
                {% get_available_languages as LANGUAGES %}
                {% get_language_info_list for LANGUAGES as languages %}
                {% for language in languages %}
                    <a  href="/{{ language.code }}/{% remove_url_prefix request.path %}" type="button" class="btn
                     {% if language.code == LANGUAGE_CODE  %}btn-primary{%else%} btn-secondary {% endif %}"
                        title="{{language.name_local|title}}">
                        {{ language.code|upper}}
                    </a>
                {% endfor %}
            </div>
        </div>
    </nav>
    <!-- Modal -->
    <div class="modal fade" id="modalOrder" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title text-primary" id="modalOrderTitle">{% trans 'Your Order'%}</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body px-0" id="modalBody">
            ...
          </div>
        </div>
      </div>
    </div>
        {% with total_items=cart|length %}
    <div class="container">
        {% block body %}
        {% endblock %}
    </div>
    <div class="cart fixed-bottom digi py-1 bg-primary">
        <div class="offset-lg-6 offset-md-3 row px-3">
            <div class="col-7 col-lg-8 text-right">
                <button type="button" class="btn btn-block btn-light float-right px-3" onClick="getOrder()">
                    {% if cart|length > 0 %}
                    <span class="fas fa-utensils d-none d-md-inline"> {% trans 'Order' %}:</span>
                    <a>
                        <span class="d-none d-md-inline">{{ total_items }} {% trans 'Product'%}{{ total_items|pluralize }},</span>
                        <span class="d-sm-inline d-md-none">Total: </span>${{ cart.get_total_price }}
                    </a>

                    {% else %}
                    <span class="fas fa-utensils"> {% trans 'Empty' %}</span>
                    {% endif %}
                </button>
            </div>
            {% if cart|length > 0 %}
            <div class="col-lg-4 col-5">
                <button type="button" class="btn btn-block btn-success" onClick="getOrder()">
                    <span class="d-none d-sm-inline">{%trans 'Send order'%}</span> <i class="fab fa-whatsapp"></i>
                </button>
            </div>
            {% endif %}

        </div>
        {% endwith %}
    </div>
    <script>
        function getOrder() {
            $('#modalOrder').modal('show');
            $.ajax({
                type: "get",
                url: "{% url 'cart:cart_detail' %}",
                success: function(data) {
                    let div = document.getElementById('modalBody');
                    div.innerHTML = data;
                }
            });
        };
        var csrftoken = Cookies.get('csrftoken');
        function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
        beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
        }
        });
    </script>

    {% block scripts %}
    {% endblock %}
    <footer>
        <div class="col-md-12 text-center bg-primary text-white digi">
            <p>Made with love by My2Menu</p>
        </div>
    </footer>
</body>
</html>